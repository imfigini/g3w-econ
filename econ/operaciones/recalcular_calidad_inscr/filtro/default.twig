{% extends "kernel/pagelet.twig" %}
{% block contenido %}
    {% set vista_form = this.get_vista_form() %}
	{{ vista_form.render_encabezado() | raw }}
	<div class="titulo_operacion">
		<h2 class="clearfix">
			<span class="pull-left">
				{{"recalcular_calidad_inscr"|trans|capitalize}}
			</span>
			<span class="pull-right">
			{{ vista_form.render_acciones() | raw }}
			</span>
		</h2>
	</div>
	{{ vista_form.render_cuerpo() | raw }}
	{{ vista_form.render_cierre() | raw }}
	
	{# Mensaje si se guardo con exito #}
    {% if (this.data.mensaje != '') %}
        <script>kernel.ui.show_mensaje('{{this.data.mensaje}}')</script>
    {% endif %} 
	
	{#  Mensaje si hubo error al guardar      #}
    {% if (this.data.mensaje_error != '') %}
        <script>kernel.ui.show_mensaje('{{this.data.mensaje_error}}', {tipo: 'alert-error'})</script>
        <div role='alert' class="alert alert-error">{{this.data.mensaje_error}}</div>
    {% endif %}

	<div role='alert' class="alert">
		<p>Se listan los alumnos que tienen la calidad de inscripción seleccionada a cada comisión cuya escala de notas sea regulares y promocionales (4).
			Esta operación permite recalcular la condición a la que pueden aspirar (en caso de ser REGULAR) luego de la fecha de finalización del último turno de examen regular del cuatrimestre.
			Sólo aplica a alumnos de los planes vigentes inscriptos a comisiones de materias que pertenecen a algún mix. </p>
	</div>

	{% if(this.data.alumnos) %}
		
		<div role='alert' class="alert">
			<p>Fecha límite considerada: {% if (this.data.fecha_limite) %} {{this.data.fecha_limite|date("d/m/Y") }} {% else %} <em>No se recuperó ninguna fecha de finalización de turno de examen regular. No se puede calcular la nueva calidad del alumno </em> {% endif %} </p>
		</div>
		<form name="calidad_alumnos" method="post" action="{{this.data.form_url_grabar}}">
			<input type="hidden" name="anio_academico_hash" value="{{this.data.anio_academico_hash}}">
			<input type="hidden" name="periodo_hash" value="{{this.data.periodo_hash}}">
			<input type="hidden" name="calidad" value="{{this.data.calidad}}">
			<table class="table table-striped table-bordered table-condensed" summary="Tabla de calidad de alumnos">
				<thead>
					<tr>
						<th>#</th>
						<th>Legajo</th>
						<th>Alumno</th>
						<th>Carrera</th>
						<th>Materia</th>
						<th>Comisión</th>
						<th>Calidad de inscripción</th>
						<th>Calidad a asignar</th>
						<th>Observaciones</th>
						<th></th>
					</tr> 
				</thead>
				<tbody>
					{% set i = 1 %}
					{% for alumno in this.data.alumnos %}
						<tr>
							<td> {{i}}</td>
							<td> {{ alumno.LEGAJO }} </td>
							<td> {{ alumno.ALUMNO }} </td>
							<td> {{ alumno.CARRERA_NOMBRE }} </td>
							<td> {{ alumno.MATERIA_NOMBRE }} </td>
							<td> {{ alumno.COMISION }} </td>
							<td> {{ alumno.CALIDAD_INSC }} </td>
							<td> {% if (alumno.CALIDAD_ASIGNAR == 'P')%} 
									<p class="cambiar"> {{ alumno.CALIDAD_ASIGNAR }} </p>
									<input type="hidden" name="datos[{{alumno.CARRERA}}][{{alumno.LEGAJO}}][{{alumno.COMISION}}][{{alumno.CALIDAD_INSC}}]" value="{{ alumno.CALIDAD_ASIGNAR }}">
								{% else %}
									{{ alumno.CALIDAD_ASIGNAR }}
								{% endif %}  </td>
							<td> {{alumno.OBSERV}} </td>
							<td> 
								<input type='checkbox' id='checkbox_{{ alumno.COMISION }}_{{ alumno.LEGAJO }}'
										{{ (alumno.CALIDAD_ASIGNAR == 'P') ? 'checked' : 'disabled' }}
								/>
							</td>
						</tr>
						{% set i = i+1 %}
					{% endfor %}
					<tr>
						<td scope="row" colspan="10">
							<div style="text-align: right">
								{# {% if (this.data.fecha_limite) %}  #}
									<button class="btn btn-info btn-lg" type="submit" id="boton_guardar">Guardar</button>
								{# {% endif %} #}
							</div>
						</td>
					</tr>
				</tbody>
			</table>
		</form>

    {% else %}
        <div role="alert" class="alert">
            {{"sin_resultados"|trans|capitalize}}
        </div>
    {% endif %}
{% endblock %}
